function Donatello(id,x,y,w,h){this.properties={};this.attrMap={fill:"backgroundColor",stroke:"borderColor","stroke-style":"borderStyle",r:"borderRadius",type:null,children:null,transform:Donatello.getTransform()};if(typeof id=="string"){var el=document.getElementById(id);Donatello.createElement(x,y,w,h,el);this.dom=el}else if(id!=null){this.dom=id}}Donatello.CORRECT_FOR_STROKE=true;Donatello.getTransform=function(){var transform;var testEl=document.createElement("div");if(Donatello.transform==undefined){if(typeof testEl.style.transform!="undefined"){transform="transform"}else if(typeof testEl.style.webkitTransform!="undefined"){transform="webkitTransform"}else if(typeof testEl.style.MozTransform!="undefined"){transform="MozTransform"}else if(typeof testEl.style.msTransform!="undefined"){transform="msTransform"}else if(typeof testEl.style.OTransform!="undefined"){transform="OTransform"}else{transform=null}console.log("css transform: "+transform);Donatello.transform=transform}else{transform=Donatello.transform}return transform};Donatello.merge=function(src,dst){for(var prop in src){dst[prop]=src[prop]}return dst};Donatello.prototype.draw=function(){};Donatello.paper=function(id,x,y,z,w,h){return new Donatello(id,x,y,z,w,h)};Donatello.createLinearGradient=function(deg,color1,color2){deg=Math.floor(deg/45);var webkitLine="center top, center bottom";switch(deg){case 0:webkitLine="left center, right center";break;case 1:webkitLine="left bottom, right top";break;case 2:webkitLine="center bottom, center top";break;case 3:webkitLine="right bottom, left top";break;case 4:webkitLine="right center, left center";break;case 5:webkitLine="right top, left bottom";break;case 6:webkitLine="center top, center bottom";break;case 7:webkitLine="left top, right bottom";break;case 8:webkitLine="left center, right center";break}var retval;switch(Donatello.getTransform()){case"MozTransform":retval="-moz-linear-gradient("+deg*45+"deg,"+color1+", "+color2+")";break;case"webkitTransform":retval="-webkit-gradient(linear, "+webkitLine+", from("+color1+"), to("+color2+"))";break;case"msTransform":var gtype=Math.floor(deg%4/2);retval="progid:DXImageTransform.Microsoft.gradient(GradientType="+gtype+', startColorstr="'+color1+'", endColorstr="'+color2+'")';break;case"OTransform":retval="-o-linear-gradient("+deg*45+"deg,"+color1+","+color2+")";break}return retval};Donatello.prototype.rotate=function(deg){this.dom.style[Donatello.getTransform()]+="rotate("+deg+"deg)"};Donatello.prototype.clear=function(){while(this.dom.hasChildNodes()){this.dom.removeChild(this.dom.lastChild)}};Donatello.prototype["delete"]=function(){this.dom.parentNode.removeChild(this.dom)};Donatello.prototype.node=function(){return this.dom};Donatello.prototype.parent=function(){return this._parent};Donatello.prototype.attr=function(obj){if(obj==undefined)return this.properties;Donatello.merge(obj,this.properties);var mapping=this.attrMap;for(attr in obj){if(mapping[attr]!=null){if(attr=="r"||attr=="stroke-width"){this.dom.style[mapping[attr]]=obj[attr]+"px"}else if(attr=="fill"){if(obj["fill"]&&obj["fill"].length>7){var str=obj["fill"];this.dom.style["backgroundImage"]=Donatello.createLinearGradient(str.substr(0,2),str.substr(3,7),str.substr(11,7))}else{this.dom.style[mapping[attr]]=obj[attr]}}else if(attr=="scale"){}else{this.dom.style[mapping[attr]]=obj[attr]}}else if(attr!="stroke-width"&&attr!="x"&&attr!="y"&&attr!="w"&&attr!="h"&&attr!="type"&&attr!="children"){if(typeof this.styleableElements!="undefined"){for(var i=0;i<this.styleableElements.length;i++){console.log("setting "+attr+" to "+obj[attr]);this.styleableElements[i].style[attr]=obj[attr]}}else{this.dom.style[attr]=obj[attr]}}}this.draw();return this};Donatello.createElement=function(x,y,w,h,name){var el;if(typeof name=="string"){el=document.createElement(name)}else{el=name}el.style.position="absolute";el.style.top=y+"px";el.style.left=x+"px";el.style.width=w+"px";el.style.height=h+"px";return el};Donatello.attrDefaults=function(a){a=a||{};if(a["stroke-width"]===undefined)a["stroke-width"]=1;if(!a["stroke"])a["stroke"]="black";if(!a["fill"])a["fill"]="transparent";if(!a["stroke-style"])a["stroke-style"]="solid";return a};Donatello.prototype.rect=function(x,y,w,h,a){return this.pgram(x,y,w,h,null,a)};Donatello.Pgram=function(parent,x,y,dx,dy,skew,a){a=Donatello.attrDefaults(a);var el=Donatello.createElement(x,y,dx,dy,"div");var s=a["stroke-width"];var c=a["stroke"];var f=a["fill"];var style=a["stroke-style"];this.properties={x:x,y:y,w:dx,h:dy,skew:skew,"stroke-width":s,"stroke-style":style,stroke:c,fill:f};parent.dom.appendChild(el);this._parent=parent;this.dom=el;this.attr(a)};Donatello.Pgram.prototype=new Donatello(null);Donatello.Pgram.prototype.draw=function(){var el=this.dom;var skew=this.properties.skew;el.style.borderWidth=this.properties["stroke-width"]+"px";if(skew!=null){console.log("setting skew "+skew);el.style[Donatello.getTransform()]+="skew("+skew+"deg)"}if(Donatello.CORRECT_FOR_STROKE){var strokeWidth=this.properties["stroke-width"];el.style.top=this.properties.y-strokeWidth/2+"px";el.style.left=this.properties.x-strokeWidth/2+"px";el.style.width=this.properties.w-strokeWidth+"px";el.style.height=this.properties.h-strokeWidth+"px"}else{el.style.top=this.properties.y+"px";el.style.left=this.properties.x+"px";el.style.width=this.properties.w+"px";el.style.height=this.properties.h+"px"}};Donatello.prototype.pgram=function(x,y,dx,dy,skew,a){return new Donatello.Pgram(this,x,y,dx,dy,skew,a)};Donatello.Circle=function(parent,x,y,r,a){a=Donatello.attrDefaults(a);var s=a["stroke-width"];var c=a["stroke"];var f=a["fill"];var style=a["stroke-style"];this.properties={x:x,y:y,r:r,"stroke-width":s,"stroke-style":style,stroke:c,fill:f};var el=Donatello.createElement(x-r-s,y-r-s,2*r,2*r,"div");parent.dom.appendChild(el);this._parent=parent;this.dom=el;this.attr(a)};Donatello.Circle.prototype=new Donatello(null);Donatello.prototype.circle=function(x,y,r,a){return new Donatello.Circle(this,x,y,r,a)};Donatello.Circle.prototype.draw=function(){var s=this.properties["stroke-width"];var x=this.properties.x;var y=this.properties.y;var r=this.properties.r;var c=this.properties.stroke;var f=this.properties.fill;var style=this.properties["stroke-style"];var el=this.dom;el.style.borderRadius=r+s+"px";el.style.borderWidth=s+"px";el.style.borderStyle=style;el.style.bordercolor=c;el.style.backgroundColor=f;if(Donatello.CORRECT_FOR_STROKE){el.style.left=x-r-s/2+"px";el.style.top=y-r-s/2+"px";el.style.width=2*r-s+"px";el.style.height=2*r-s+"px"}else{el.style.left=x-r-s+"px";el.style.top=y-r-s+"px"}};Donatello.Ellipse=function(parent,x,y,rx,ry,a){a=Donatello.attrDefaults(a);var s=a["stroke-width"];var c=a["stroke"];var f=a["fill"];var style=a["stroke-style"];this.properties={x:x,y:y,rx:rx,ry:ry,"stroke-width":s,"stroke-style":style,stroke:c,fill:f};var el=Donatello.createElement(x-rx-s,y-ry-s,2*rx,2*ry,"div");parent.dom.appendChild(el);this._parent=parent;this.dom=el;this.attr(a)};Donatello.Ellipse.prototype=new Donatello(null);Donatello.prototype.ellipse=function(x,y,rx,ry,a){return new Donatello.Ellipse(this,x,y,rx,ry,a)};Donatello.Ellipse.prototype.draw=function(){var x=this.properties.x;var y=this.properties.y;var r=this.properties.r;var rx=this.properties.rx;var ry=this.properties.ry;var s=this.properties["stroke-width"];var c=this.properties.stroke;var f=this.properties.fill;var style=this.properties["stroke-style"];var el=this.dom;el.style.borderRadius=rx+s+"px / "+(ry+s)+"px";el.style.borderWidth=s+"px";el.style.borderStyle=style;el.style.borderColor=c;el.style.backgroundColor=f;el.style.left=x-rx-s+"px";el.style.top=y-ry-s+"px"};Donatello.Arc=function(parent,x,y,r,t1,t2,a){a=Donatello.attrDefaults(a);var s=a["stroke-width"];var c=a["stroke"];var f=a["fill"];var style=a["stroke-style"];this.properties={x:x,y:y,r:r,t1:t1,t2:t2,"stroke-width":s,"stroke-style":style,stroke:c,fill:f};var deg=t2;var clip=Donatello.createElement(x-2*r,y-2*r,2*r,2*r,"div");var c1=Donatello.createElement(r-s/2,r-s/2,2*r-s,2*r-s,"div");var c2=Donatello.createElement(r-s/2,r-s/2,2*r-s,2*r-s,"div");var c3=Donatello.createElement(r-s/2,r-s/2,2*r-s,2*r-s,"div");var c4=Donatello.createElement(r-s/2,r-s/2,2*r-s,2*r-s,"div");clip.appendChild(c1);clip.appendChild(c2);clip.appendChild(c3);clip.appendChild(c4);this.styleableElements=[c1,c2,c3,c4];clip.style[Donatello.transform+"Origin"]="100% 100%";parent.dom.appendChild(clip);this._parent=parent;this.dom=clip;this.draw(t2)};Donatello.Arc.prototype=new Donatello(null);Donatello.prototype.arc=function(x,y,r,t1,t2,a){return new Donatello.Arc(this,x,y,r,t1,t2,a)};Donatello.Arc.prototype.draw=function(t2){var angle=t2;var t1=this.properties.t1;if(angle<90){this.dom.style.overflow="hidden";this.dom.style[Donatello.transform]="rotate("+(180+t1)+"deg)"+"skew("+(90-angle)+"deg)"}else{this.dom.style.overflow="visible";this.dom.style[Donatello.transform]="rotate("+(180+t1)+"deg)"+"skew(0deg)"}var x=this.properties.x;var y=this.properties.y;var r=this.properties.r;var s=this.properties["stroke-width"];var c=this.properties.stroke;var f=this.properties.fill;var style=this.properties["stroke-style"];function setprops(el,ang){el.style.borderRadius=r+s+"px";el.style.borderWidth=s+"px";el.style.borderStyle=style;el.style.borderColor=c;el.style.borderBottomColor="transparent";el.style.borderLeftColor="transparent";el.style.borderRightColor="transparent";el.style.backgroundColor=f;if(angle<90){el.style[Donatello.transform]="skew("+-(90-angle)+"deg)rotate("+(ang-45)+"deg)"}else{el.style[Donatello.transform]="rotate("+(ang-45)+"deg)"}}for(var i=0;i<4;i++){setprops(this.dom.children[i],(angle-90)*i/3)}};Donatello.Line=function(parent,x,y,dx,dy,a){a=Donatello.attrDefaults(a);var w=a["stroke-width"];this.properties={x:x,y:y,dx:dx,dy:dy,"stroke-width":w};var c=a["stroke"];var f=a["fill"];var style=a["stroke-style"];var el=Donatello.createElement(x,y,0,0,"div");this.attrMap["stroke-width"]="borderTopWidth";this.attrMap["stroke-style"]="borderTopStyle";this.attrMap["stroke"]="borderTopColor";this.dom=el;this._parent=parent;this.draw(a);el.style[Donatello.getTransform()+"Origin"]="0px 0px";parent.dom.appendChild(el);this.attr(a)};Donatello.Line.prototype=new Donatello(null);Donatello.Line.prototype.draw=function(a){var x=this.properties.x;var y=this.properties.y;var dx=this.properties.dx;var dy=this.properties.dy;var stroke=this.properties["stroke-width"];var len=Math.sqrt(dx*dx+dy*dy);this.dom.style.width=len+"px";this.dom.style.height="0px";var rot=Math.asin(Math.abs(dy)/len);rot=rot*(180/Math.PI);if(dx<0&&dy>=0){rot=180-rot}else if(dx<0&&dy<0){rot=180+rot}else if(dx>=0&&dy<0){rot=360-rot}this.dom.style[Donatello.getTransform()]="rotate("+rot+"deg) translate(0px, -"+stroke/2+"px)";this.dom.style["borderTopWidth"]=stroke+"px";this.dom.style.left=x+"px";this.dom.style.top=y+"px"};Donatello.prototype.line=function(x,y,dx,dy,a){return new Donatello.Line(this,x,y,dx,dy,a)};Donatello.Text=function(parent,x,y,str,a){a=Donatello.attrDefaults(a);this.properties={x:x,y:y,str:str};var el=Donatello.createElement(x,y,null,null,"div");this.dom=el;this.draw();this._parent=parent;parent.dom.appendChild(el);this.attr(a)};Donatello.Text.prototype=new Donatello(null);Donatello.Text.prototype.draw=function(){this.dom.innerHTML=this.properties["str"];this.dom.style.top=this.properties["y"]+"px";this.dom.style.left=this.properties["x"]+"px"};Donatello.prototype.text=function(x,y,str,a){return new Donatello.Text(this,x,y,str,a)};